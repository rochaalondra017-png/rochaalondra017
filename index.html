<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Ruleta de Promociones</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Poppins:wght@500&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f1f1f1; /* Sausy White */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      text-align: center;
    }

    h1 {
      font-family: 'Permanent Marker', cursive;
      color: #254eff; /* Smashy Blue */
      margin-bottom: 10px;
    }

    #wheelContainer {
      position: relative;
      width: 400px;
      height: 400px;
    }

    #wheelCanvas {
      border: 8px solid #ff9000; /* Bum Orange */
      border-radius: 50%;
    }

    /* Flecha */
    #arrow {
      position: absolute;
      bottom: -30px; /* flecha más abajo para no tapar el botón */
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      Border-bottom: 30px solid #ff9000; /* Flecha apuntando hacia abajo */
      z-index: 10;
    }

    #nameInput {
      margin: 15px 0;
      padding: 8px;
      border: 2px solid #254eff;
      border-radius: 5px;
      width: 70%;
    }

    #spinBtn {
      margin-top: 50px;
      padding: 12px 25px;
      background-color: #254eff;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }

    #spinBtn:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }

    #spinBtn:hover:enabled {
      background-color: #ff9000;
    }

    #result {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
      color: #333;
    }

    #shareMsg {
      margin-top: 10px;
      font-size: 14px;
      color: #254eff;
    }
  </style>
</head>
<body>

  <h1>🎡 RULETA MR SMASH 🎡</h1>

  <input type="text" id="nameInput" placeholder="Escribe tu nombre para jugar">
  <div id="wheelContainer">
    <canvas id="wheelCanvas" width="400" height="400"></canvas>
    <div id="arrow"></div>
  </div>
  <button id="spinBtn">¡Girar!</button>
  <div id="result"></div>
  <div id="shareMsg"></div>

  <script>
    const options = [
      "10% OFF", "Gracias por participar",
      "Mr Fresh Gratis", "Brownie Gratis",
      "Papas Smash Gratis", "Envío Gratis",
      "5% OFF", "Suerte para la próxima",
      "Postre Gratis", "5% OFF",
      "Sigue participando", "Papas Extra"
    ];

    const colors = [
      "#254eff", "#f1f1f1",
      "#ff9000", "#f1f1f1",
      "#254eff", "#f1f1f1",
      "#ff9000", "#f1f1f1",
      "#254eff", "#f1f1f1",
      "#ff9000", "#f1f1f1"
    ];

    let startAngle = 340;
    const arcSize = (2 * Math.PI) / options.length;
    const canvas = document.getElementById("wheelCanvas");
    const ctx = canvas.getContext("2d");

    function drawWheel() {
      for (let i = 0; i < options.length; i++) {
        const angle = startAngle + i * arcSize;
        ctx.beginPath();
        ctx.fillStyle = colors[i];
        ctx.moveTo(200, 200);
        ctx.arc(200, 200, 200, angle, angle + arcSize, false);
        ctx.lineTo(200, 200);
        ctx.fill();
        ctx.save();

        // Texto
        ctx.fillStyle = "#000";
        ctx.translate(200, 200);
        ctx.rotate(angle + arcSize / 2);
        ctx.textAlign = "right";
        ctx.font = "bold 14px Poppins";
        ctx.fillText(options[i], 180, 10);
        ctx.restore();
      }
    }

    function rotateWheel() {
      const name = document.getElementById("nameInput").value.trim();
      if (!name) {
        alert("Por favor, escribe tu nombre antes de girar.");
        return;
      }

      document.getElementById("spinBtn").disabled = true;
      const spinAngle = Math.random() * 360 + 1800; // mínimo 5 giros
      const duration = 4000;
      const start = performance.now();

      function animate(now) {
        const elapsed = now - start;
        if (elapsed < duration) {
          const angle = spinAngle * (elapsed / duration);
          startAngle = (angle * Math.PI) / 180;
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          drawWheel();
          requestAnimationFrame(animate);
        } else {
          // Calcular premio con flecha abajo
          // Al terminar la animación: 
          const finalAngle = startAngle % (2 * Math.PI);

          //Convertir a grados
          let degrees = finalAngle * (360 / Math.PI);

          
          degrees = (degrees + 90) % 360;
          const index = Math.floor(degrees / (360 / options.length));
          

          const prize = options[index];
          document.getElementById("result").innerText =
            prize === "" ? `❌ Lo sentimos ${name}, intenta de nuevo.` : `🎉  ${name} , : Tienes 5 días a partir de esta captura para reclamar tu premio! 🎉 `;

          document.getElementById("shareMsg").innerText =
            "📸 Toma una captura, súbela a tus historias y comparte tu resultado para que más personas jueguen 🎡 Vigencia del premio 5 días después de esta captura"; 
        }
      }
      requestAnimationFrame(animate);
    }

    drawWheel();
    document.getElementById("spinBtn").addEventListener("click", rotateWheel);
  </script>
</body>
</html>